{
  Schema = {
    direnv = {
      enable
        | doc m%"
          Whether to enable the [direnv](https://github.com/direnv/direnv) integration.
        "%
        | Bool
        | default
        = true,
      watch_files
        | doc m%"
          Reload the shell when the contents of these files change.
        "%
        | Array String
        | default
        = []
    },
    files =
      if direnv.enable then
        {
          ".envrc".content = m%"
            if ! has nix_direnv_version || ! nix_direnv_version 2.4.0; then
              source_url "https://raw.githubusercontent.com/nix-community/nix-direnv/2.4.0/direnvrc" "sha256-XQzUAvL6pysIJnRJyR7uVpmUSZfc7LSgWQwq/4mBr1U="
            fi
            nix_direnv_watch_file project.ncl nickel.lock.ncl %{std.string.join " " direnv.watch_files}
            source_env_if_exists ".envrc.private"
            use flake
          "%,
        }
      else
        {},
  },
}
